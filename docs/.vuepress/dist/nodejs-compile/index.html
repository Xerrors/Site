<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>后端 Nodejs 配置 | Xerrors</title>
    <meta name="description" content="Xerrors playground">
    <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.655ad899.css" as="style"><link rel="preload" href="/assets/js/app.e2860514.js" as="script"><link rel="preload" href="/assets/js/7.b3d46475.js" as="script"><link rel="preload" href="/assets/js/31.9a9c566f.js" as="script"><link rel="prefetch" href="/assets/js/1.d2302d19.js"><link rel="prefetch" href="/assets/js/10.363a5f2e.js"><link rel="prefetch" href="/assets/js/11.a450bcf4.js"><link rel="prefetch" href="/assets/js/12.82e844ca.js"><link rel="prefetch" href="/assets/js/13.fe61535e.js"><link rel="prefetch" href="/assets/js/14.4a644140.js"><link rel="prefetch" href="/assets/js/15.91d9f7b2.js"><link rel="prefetch" href="/assets/js/16.9fa16092.js"><link rel="prefetch" href="/assets/js/17.1109ac86.js"><link rel="prefetch" href="/assets/js/18.b496fab0.js"><link rel="prefetch" href="/assets/js/19.c1337c49.js"><link rel="prefetch" href="/assets/js/2.64cb9093.js"><link rel="prefetch" href="/assets/js/20.adb9c468.js"><link rel="prefetch" href="/assets/js/21.0b801de1.js"><link rel="prefetch" href="/assets/js/22.e226cd6c.js"><link rel="prefetch" href="/assets/js/23.7e4bf0b7.js"><link rel="prefetch" href="/assets/js/24.531710cb.js"><link rel="prefetch" href="/assets/js/25.8f290cfc.js"><link rel="prefetch" href="/assets/js/26.7a2413df.js"><link rel="prefetch" href="/assets/js/27.501750f5.js"><link rel="prefetch" href="/assets/js/28.c9a0adb4.js"><link rel="prefetch" href="/assets/js/29.72f1bbac.js"><link rel="prefetch" href="/assets/js/30.43d9e62a.js"><link rel="prefetch" href="/assets/js/32.57b91ebe.js"><link rel="prefetch" href="/assets/js/33.2501e341.js"><link rel="prefetch" href="/assets/js/34.059a7ff2.js"><link rel="prefetch" href="/assets/js/35.f762ef37.js"><link rel="prefetch" href="/assets/js/36.48ae2338.js"><link rel="prefetch" href="/assets/js/37.96d8c490.js"><link rel="prefetch" href="/assets/js/38.e946d314.js"><link rel="prefetch" href="/assets/js/39.d3f25431.js"><link rel="prefetch" href="/assets/js/4.a16b4593.js"><link rel="prefetch" href="/assets/js/40.7cac8664.js"><link rel="prefetch" href="/assets/js/41.55074705.js"><link rel="prefetch" href="/assets/js/42.bccf86c5.js"><link rel="prefetch" href="/assets/js/43.4354f2a0.js"><link rel="prefetch" href="/assets/js/44.27eb8fb7.js"><link rel="prefetch" href="/assets/js/45.7edf95e7.js"><link rel="prefetch" href="/assets/js/46.051b3701.js"><link rel="prefetch" href="/assets/js/47.d3f63876.js"><link rel="prefetch" href="/assets/js/5.20ac7044.js"><link rel="prefetch" href="/assets/js/6.0b7e65d8.js"><link rel="prefetch" href="/assets/js/8.3b82d74a.js"><link rel="prefetch" href="/assets/js/9.c6854e86.js">
    <link rel="stylesheet" href="/assets/css/0.styles.655ad899.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><!----> <div id="my-bg"></div> <header class="navbar my-nav"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.jpg" alt="Xerrors" class="logo"> <span class="site-name can-hide">Xerrors</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">📃 文章</a></div><div class="nav-item"><a href="/zhuanlan/" class="nav-link">📰 专栏</a></div><div class="nav-item"><a href="/zone/" class="nav-link">🤪 动态</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">🔨 工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">🚥 导航</a></li><li class="dropdown-item"><!----> <a href="/tools/findpwd.html" class="nav-link">🔐 寻密</a></li><li class="dropdown-item"><!----> <a href="/tools/links.html" class="nav-link">🔗 友链</a></li><li class="dropdown-item"><!----> <a href="https://www.notion.so/krance/7af4256cdc35438d919833f4c6192128?v=5219488bae934ab3a621e7c8b123d08b" target="_blank" rel="noopener noreferrer" class="nav-link external">
  👩‍🚀 Notion
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">📃 文章</a></div><div class="nav-item"><a href="/zhuanlan/" class="nav-link">📰 专栏</a></div><div class="nav-item"><a href="/zone/" class="nav-link">🤪 动态</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">🔨 工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">🚥 导航</a></li><li class="dropdown-item"><!----> <a href="/tools/findpwd.html" class="nav-link">🔐 寻密</a></li><li class="dropdown-item"><!----> <a href="/tools/links.html" class="nav-link">🔗 友链</a></li><li class="dropdown-item"><!----> <a href="https://www.notion.so/krance/7af4256cdc35438d919833f4c6192128?v=5219488bae934ab3a621e7c8b123d08b" target="_blank" rel="noopener noreferrer" class="nav-link external">
  👩‍🚀 Notion
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <!----> </aside> <div><div style="height:4.5rem;width:100%;background:#f0f2f5;"></div> <main class="page need-zoom"> <div class="my-main"><div class="my-main-left"><div class="my-title-box"><h3 style="text-align: center;">后端 Nodejs 配置</h3> <div style="text-align: center; color: #A0A0A0; font-size: 14px;"><span data-flag-title="Your Article Title" class="leancloud-visitors"><span>2019-8-29  </span> <i class="el-icon-view" style="margin-right: 3px;"></i> <span class="leancloud-visitors-count"></span> <span>次浏览</span></span></div></div> <div class="theme-default-content content__default"><h3 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h3> <p>为什么会有这么一篇文章呢；原本我只是想要使用 Vuepress 搭建一个静态博客就好的，然后自己修改一下主题之类的就可以了，但是吧，这人一旦闲着就没事干，想想自己天天不发空间、不发朋友圈、不发微博，有点啥想说的也没地方说，想了想，不如放到自己的网站里面，但是单独写一篇文章也不值得，<strong>索性自己做一个类似动态一样的东西吧</strong>。正好当时在逛 GitHub 的 issues，然后就借鉴那个风格做一个，但是每次发消息都要连接服务器，写内容，发布，感觉挺麻烦的，所以还是建一个后端吧，功能比较简单，也<strong>用不到数据库，就用 JSON 管理吧</strong>。</p> <p>说干就干！</p> <h3 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h3> <p>在使用之前还是要安装一些新的东西，后端使用 express 来管理会好一点。（另一方面也是为了后面方便的配置 https）</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> express --save
</code></pre></div><p>当然，前端因为也要发送请求，所以也需要安装 <code>axios</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> axios --save
</code></pre></div><h3 id="简单的例子"><a href="#简单的例子" aria-hidden="true" class="header-anchor">#</a> 简单的例子</h3> <p>首先，因为是后端代码还是跟前端分开一点好，所以我另建了一个文件夹，同时新建一个新的文件 <code>server.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入相应的模块</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 Server </span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> httpServer <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 监听</span>
<span class="token keyword">var</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">8000</span>	<span class="token comment">// 端口</span>
httpServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HTTP Server is running on: '</span><span class="token punctuation">,</span> <span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get 请求</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Nodejs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面就是一个简单的例子，上面的简单代码就可以在浏览器中访问 8000 端口并看到结果了。</p> <p>逻辑很简单，首先引入相应的模块（前三行代码），然后用实例创建 Http 服务器，第三步开启监听，第四步对请求作出反应。</p> <h3 id="处理跨域"><a href="#处理跨域" aria-hidden="true" class="header-anchor">#</a> 处理跨域</h3> <p>因为我是把博客代码放到 GitHub Pages、Coding Page 和我的服务器上面的，所以进行数据请求的时候肯定是属于跨域访问的，所以我就需要在处理请求的时候允许跨域。</p> <p>所以对代码进行修改</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入相应的模块</span>
<span class="token operator">...</span>

<span class="token comment">// 允许所有的请求形式</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 Server</span>
<span class="token operator">...</span>
</code></pre></div><h3 id="处理-json-文件"><a href="#处理-json-文件" aria-hidden="true" class="header-anchor">#</a> 处理 JSON 文件</h3> <p>处理文件也就两种，一种是读，一种是写，也就对应着网站中出现的 <code>GET</code>、<code>POST</code>; 首先约定好，所有的数据放到一个 <code>data.json</code> 文件里面，格式为：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;msgs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2019-08-27T07:01:47.603Z&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;书签开发完成咯！就差往里面填资源了，不过，一个一个整理是真的麻烦啊！！！&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Happy&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ...
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="读取文件"><a href="#读取文件" aria-hidden="true" class="header-anchor">#</a> 读取文件</h4> <p>当接收到相应的 <code>get</code> 请求的时候，也就是指定 API 的时候，向服务器中读  <code>data.json</code>  ，然后将结果返回给前端。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Get 请求</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/getData'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 响应头</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> file <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>前端相应的代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">getMsgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8000/api/getData'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// console.log(res);</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> item <span class="token keyword">of</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msgs <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="写入文件"><a href="#写入文件" aria-hidden="true" class="header-anchor">#</a> 写入文件</h4> <p>后端的在处理 post 请求的时候，有一个是需要注意的，那就是参数的解析，所以为了方便我们再次引入一个新的东东</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入相应的模块</span>
<span class="token operator">...</span>

<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加json解析</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 允许所有的请求形式</span>
<span class="token operator">...</span>
</code></pre></div><p>通过这样设置，当前端把数据传送到后端之后，就可以直接当作 JavaScript 的对象使用了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span>

<span class="token comment">// Post 请求</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">var</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span>
    
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面是一个简单的使用方法，下一步要做的就是读取 <code>json</code> 文件里面的数据，转换成字符串，然后解析成 JavaScript 的对象。然后把前端传来的数据插入到最前面，最后再转化成字符串写到文件中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Post 请求</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">var</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token comment">// console.log(typeof(body), body)</span>
    
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> jsonData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> msgs <span class="token operator">=</span> jsonData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">// 转化读取到的 json 数据为字符串</span>
            msgs <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>msgs<span class="token punctuation">)</span>				<span class="token comment">// 解析为 js 对象</span>
            msgs<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> body<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 把新数据插入到 js 对象中</span>
            <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 转化为字符串</span>
            fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'新增成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="权限控制"><a href="#权限控制" aria-hidden="true" class="header-anchor">#</a> 权限控制</h3> <p>上述 post 的 API  可以直接修改我们服务器的数据，所以肯定是要进行权限控制，不然就完蛋了。但是单独开发一个后台管理系统也太麻烦了，所以最简单的办法就是使用一个 token 去验证咯（当然，token 的长度最好长一点，不然，一会儿就爆破出来了）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Post 请求</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        message<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        data<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>body<span class="token punctuation">.</span>token <span class="token operator">!=</span> <span class="token string">'mytoken'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">220</span>
        data<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;Wrong Token!&quot;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Wrong Token!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> jsonData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        data<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;Success&quot;</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>前端相应代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">uploadMsg</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        method<span class="token punctuation">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        url<span class="token punctuation">:</span> <span class="token string">'http://localhost:8000/api/upload'</span><span class="token punctuation">,</span>
        data<span class="token punctuation">:</span> data
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">!=</span> <span class="token number">200</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="https-访问"><a href="#https-访问" aria-hidden="true" class="header-anchor">#</a> HTTPS 访问</h3> <p>部署的时候出现了一个问题，当我的网站是 https 访问，去访问 http 的 API 会导致无法访问（俺也没学过这方面的，还不懂），所以索性就在后端启动一个 https 服务器来处理请求。</p> <p>SSL 证书可以去阿里云或者其他地方申请免费的，一年有效期，一年后重新申请。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入相应的模块</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ssl 证书</span>
<span class="token keyword">var</span> privateKey  <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'domain.key'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> certificate <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'domain_public.crt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> credentials <span class="token operator">=</span> <span class="token punctuation">{</span>key<span class="token punctuation">:</span> privateKey<span class="token punctuation">,</span> cert<span class="token punctuation">:</span> certificate<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 Server </span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> httpServer <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> httpsServer <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>credentials<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 监听</span>
<span class="token keyword">var</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">8000</span>	<span class="token comment">// 端口</span>
httpServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HTTP Server is running on: '</span><span class="token punctuation">,</span> <span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token constant">SSLPORT</span> <span class="token operator">=</span> <span class="token number">8001</span>
httpsServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">SSLPORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HTTPS Server is running on: '</span><span class="token punctuation">,</span> <span class="token constant">SSLPORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h3> <p>上面就是一个菜鸡前端的后端体验，后面会更新使用 flask 做后端的例子。</p> <p>完整代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> privateKey  <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'www.xerrors.fun.key'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> certificate <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'www.xerrors.fun_public.crt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> credentials <span class="token operator">=</span> <span class="token punctuation">{</span>key<span class="token punctuation">:</span> privateKey<span class="token punctuation">,</span> cert<span class="token punctuation">:</span> certificate<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> httpServer <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> httpsServer <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>credentials<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">8000</span>
<span class="token keyword">var</span> <span class="token constant">SSLPORT</span> <span class="token operator">=</span> <span class="token number">8001</span>

<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加json解析</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/public'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 允许所有的请求形式</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 Server</span>
httpServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HTTP Server is running on: '</span><span class="token punctuation">,</span> <span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
httpsServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">SSLPORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HTTPS Server is running on: '</span><span class="token punctuation">,</span> <span class="token constant">SSLPORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// Get 请求</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/getData'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> file <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Post 请求</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        message<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        data<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>body<span class="token punctuation">.</span>token <span class="token operator">!=</span> <span class="token string">'mytoken'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">220</span>
        data<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;Wrong Token!&quot;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Wrong Token!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> jsonData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> msgs <span class="token operator">=</span> jsonData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                msgs <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>msgs<span class="token punctuation">)</span>
                msgs<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> body<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'新增成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        data<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;Success&quot;</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'启动完成'</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">修改于: </span> <span class="time">9/1/2019, 10:55:27 AM</span></div></footer> <!----> <div style="background:white;"><section class="page-edit"><div id="vcomments"></div></section></div></div> <div class="my-menu" style="display:;"><div class="my-menu__item"><h4 style="margin-top: 0; color: #121314">目录</h4> <a href="/nodejs-compile/#前言" class="my-menu__lv3">
            前言</a><a href="/nodejs-compile/#安装" class="my-menu__lv3">
            安装</a><a href="/nodejs-compile/#简单的例子" class="my-menu__lv3">
            简单的例子</a><a href="/nodejs-compile/#处理跨域" class="my-menu__lv3">
            处理跨域</a><a href="/nodejs-compile/#处理-json-文件" class="my-menu__lv3">
            处理 JSON 文件</a><a href="/nodejs-compile/#权限控制" class="my-menu__lv3">
            权限控制</a><a href="/nodejs-compile/#https-访问" class="my-menu__lv3">
            HTTPS 访问</a><a href="/nodejs-compile/#总结" class="my-menu__lv3">
            总结</a></div></div></div> </main></div> <div class="footer">
    Copyright © 2019-2020 ❤️ Xerrors | 皖 ICP 备 19016269 号 <br> <a href="https://me.csdn.net/jaykm">CSND</a> | 
    <a href="https://github.com/Xerrors">GitHub</a></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2860514.js" defer></script><script src="/assets/js/7.b3d46475.js" defer></script><script src="/assets/js/31.9a9c566f.js" defer></script>
  </body>
</html>
